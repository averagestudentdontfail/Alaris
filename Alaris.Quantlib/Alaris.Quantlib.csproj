<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <DocumentationFile>bin\$(Configuration)\$(TargetFramework)\$(AssemblyName).xml</DocumentationFile>

    <!-- Exclude SWIG-generated code from strict enforcement -->
    <!-- This is auto-generated C++/CLI wrapper code, not authored by us -->
    <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    <EnforceCodeStyleInBuild>false</EnforceCodeStyleInBuild>

    <!-- Suppress common warnings from SWIG-generated code and native loader -->
    <!-- CS1591: Missing XML documentation -->
    <!-- CS0108: Member hides inherited member (SWIG inheritance patterns) -->
    <!-- CA5392: P/Invoke security (requires DefaultDllImportSearchPaths) -->
    <!-- CA1062: Validate public arguments (SWIG doesn't generate guard clauses) -->
    <!-- CA2000: Dispose objects (SWIG manages lifecycle differently) -->
    <!-- CA1031: Generic exception catches (Native.cs catches during library loading) -->
    <!-- CA1805: Explicit initialization to default (code generator pattern) -->
    <!-- CA1310: String culture sensitivity (Native.cs path checking) -->
    <!-- IDE0011: Add braces (SWIG-generated code style) -->
    <NoWarn>$(NoWarn);CS1591;CS0108;CA5392;CA1062;CA2000;CA1031;CA1805;CA1310;IDE0011</NoWarn>
  </PropertyGroup>

  <PropertyGroup>
    <Description>QuantLib C# bindings via SWIG for the Alaris quantitative finance system</Description>
    <Company>Alaris</Company>
    <Product>Alaris.Quantlib</Product>
    <Copyright>Copyright © 2025</Copyright>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
  </PropertyGroup>

  <!-- Native library configuration for SWIG wrapper and QuantLib runtime -->
  <ItemGroup>
    <!-- SWIG wrapper library (NQuantLibc) -->
    <Content Include="../Alaris.Library/Native/libNQuantLibc.so">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>libNQuantLibc.so</Link>
      <PackagePath>runtimes/linux-x64/native</PackagePath>
      <Pack>true</Pack>
      <Visible>false</Visible>
    </Content>
    
    <!-- Also copy with alternate name that .NET might search for -->
    <Content Include="../Alaris.Library/Native/libNQuantLibc.so">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>NQuantLibc.so</Link>
      <PackagePath>runtimes/linux-x64/native</PackagePath>
      <Pack>true</Pack>
      <Visible>false</Visible>
    </Content>
    
    <!-- QuantLib runtime libraries -->
    <Content Include="../Alaris.Library/Runtime/libQuantLib.so">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>libQuantLib.so</Link>
      <PackagePath>runtimes/linux-x64/native</PackagePath>
      <Pack>true</Pack>
      <Visible>false</Visible>
    </Content>
    
    <Content Include="../Alaris.Library/Runtime/libQuantLib.so.1">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>libQuantLib.so.1</Link>
      <PackagePath>runtimes/linux-x64/native</PackagePath>
      <Pack>true</Pack>
      <Visible>false</Visible>
    </Content>
    
    <Content Include="../Alaris.Library/Runtime/libQuantLib.so.1.39.0">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <Link>libQuantLib.so.1.39.0</Link>
      <PackagePath>runtimes/linux-x64/native</PackagePath>
      <Pack>true</Pack>
      <Visible>false</Visible>
    </Content>
  </ItemGroup>

  <!-- Fallback: Post-build event to ensure native libraries are copied -->
  <Target Name="CopyNativeLibraries" AfterTargets="Build">
    <ItemGroup>
      <NativeLibs Include="$(MSBuildProjectDirectory)/../Alaris.Library/Native/*.so" />
      <RuntimeLibs Include="$(MSBuildProjectDirectory)/../Alaris.Library/Runtime/*.so*" />
    </ItemGroup>
    <Copy SourceFiles="@(NativeLibs)" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(RuntimeLibs)" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true" />
    <Message Text="Copied native libraries from Alaris.Library to $(OutputPath)" Importance="High" />
  </Target>

</Project>